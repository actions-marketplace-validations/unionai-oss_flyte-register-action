var be=Object.create;var P=Object.defineProperty;var Ee=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var Oe=Object.getPrototypeOf,$e=Object.prototype.hasOwnProperty;var Ie=e=>P(e,"__esModule",{value:!0});var S=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Ce=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Se(t))!$e.call(e,i)&&i!=="default"&&P(e,i,{get:()=>t[i],enumerable:!(r=Ee(t,i))||r.enumerable});return e},D=e=>Ce(Ie(P(e!=null?be(Oe(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var I=S($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.toCommandValue=void 0;function je(e){return e==null?"":typeof e=="string"||e instanceof String?e:JSON.stringify(e)}$.toCommandValue=je});var Y=S(y=>{"use strict";var Ne=y&&y.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),Pe=y&&y.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),De=y&&y.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&Ne(t,e,r);return Pe(t,e),t};Object.defineProperty(y,"__esModule",{value:!0});y.issue=y.issueCommand=void 0;var Fe=De(require("os")),k=I();function X(e,t,r){let i=new J(e,t,r);process.stdout.write(i.toString()+Fe.EOL)}y.issueCommand=X;function Te(e,t=""){X(e,{},t)}y.issue=Te;var z="::",J=class{constructor(t,r,i){t||(t="missing.command"),this.command=t,this.properties=r,this.message=i}toString(){let t=z+this.command;if(this.properties&&Object.keys(this.properties).length>0){t+=" ";let r=!0;for(let i in this.properties)if(this.properties.hasOwnProperty(i)){let s=this.properties[i];s&&(r?r=!1:t+=",",t+=`${i}=${Ae(s)}`)}}return t+=`${z}${xe(this.message)}`,t}};function xe(e){return k.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function Ae(e){return k.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}});var Q=S(g=>{"use strict";var Ue=g&&g.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),qe=g&&g.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Z=g&&g.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&Ue(t,e,r);return qe(t,e),t};Object.defineProperty(g,"__esModule",{value:!0});g.issueCommand=void 0;var K=Z(require("fs")),Me=Z(require("os")),We=I();function Re(e,t){let r=process.env[`GITHUB_${e}`];if(!r)throw new Error(`Unable to find environment variable for file command ${e}`);if(!K.existsSync(r))throw new Error(`Missing file at path: ${r}`);K.appendFileSync(r,`${We.toCommandValue(t)}${Me.EOL}`,{encoding:"utf8"})}g.issueCommand=Re});var ce=S(n=>{"use strict";var Ge=n&&n.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),Ve=n&&n.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),ee=n&&n.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&Ge(t,e,r);return Ve(t,e),t},Be=n&&n.__awaiter||function(e,t,r,i){function s(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function d(l){try{p(i.next(l))}catch(h){a(h)}}function E(l){try{p(i.throw(l))}catch(h){a(h)}}function p(l){l.done?o(l.value):s(l.value).then(d,E)}p((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});n.getState=n.saveState=n.group=n.endGroup=n.startGroup=n.info=n.warning=n.error=n.debug=n.isDebug=n.setFailed=n.setCommandEcho=n.setOutput=n.getBooleanInput=n.getInput=n.addPath=n.setSecret=n.exportVariable=n.ExitCode=void 0;var _=Y(),te=Q(),He=I(),C=ee(require("os")),Le=ee(require("path")),re;(function(e){e[e.Success=0]="Success",e[e.Failure=1]="Failure"})(re=n.ExitCode||(n.ExitCode={}));function ke(e,t){let r=He.toCommandValue(t);if(process.env[e]=r,process.env.GITHUB_ENV||""){let s="_GitHubActionsFileCommandDelimeter_",o=`${e}<<${s}${C.EOL}${r}${C.EOL}${s}`;te.issueCommand("ENV",o)}else _.issueCommand("set-env",{name:e},r)}n.exportVariable=ke;function Xe(e){_.issueCommand("add-mask",{},e)}n.setSecret=Xe;function ze(e){process.env.GITHUB_PATH||""?te.issueCommand("PATH",e):_.issueCommand("add-path",{},e),process.env.PATH=`${e}${Le.delimiter}${process.env.PATH}`}n.addPath=ze;function ie(e,t){let r=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!r)throw new Error(`Input required and not supplied: ${e}`);return t&&t.trimWhitespace===!1?r:r.trim()}n.getInput=ie;function Je(e,t){let r=["true","True","TRUE"],i=["false","False","FALSE"],s=ie(e,t);if(r.includes(s))return!0;if(i.includes(s))return!1;throw new TypeError(`Input does not meet YAML 1.2 "Core Schema" specification: ${e}
Support boolean input list: \`true | True | TRUE | false | False | FALSE\``)}n.getBooleanInput=Je;function Ye(e,t){process.stdout.write(C.EOL),_.issueCommand("set-output",{name:e},t)}n.setOutput=Ye;function Ze(e){_.issue("echo",e?"on":"off")}n.setCommandEcho=Ze;function Ke(e){process.exitCode=re.Failure,ne(e)}n.setFailed=Ke;function Qe(){return process.env.RUNNER_DEBUG==="1"}n.isDebug=Qe;function et(e){_.issueCommand("debug",{},e)}n.debug=et;function ne(e){_.issue("error",e instanceof Error?e.toString():e)}n.error=ne;function tt(e){_.issue("warning",e instanceof Error?e.toString():e)}n.warning=tt;function rt(e){process.stdout.write(e+C.EOL)}n.info=rt;function oe(e){_.issue("group",e)}n.startGroup=oe;function se(){_.issue("endgroup")}n.endGroup=se;function it(e,t){return Be(this,void 0,void 0,function*(){oe(e);let r;try{r=yield t()}finally{se()}return r})}n.group=it;function nt(e,t){_.issueCommand("save-state",{name:e},t)}n.saveState=nt;function ot(e){return process.env[`STATE_${e}`]||""}n.getState=ot});var fe=S(c=>{"use strict";var j=c&&c.__awaiter||function(e,t,r,i){function s(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function d(l){try{p(i.next(l))}catch(h){a(h)}}function E(l){try{p(i.throw(l))}catch(h){a(h)}}function p(l){l.done?o(l.value):s(l.value).then(d,E)}p((i=i.apply(e,t||[])).next())})},ue=c&&c.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},m;Object.defineProperty(c,"__esModule",{value:!0});var st=require("assert"),ct=ue(require("fs")),O=ue(require("path"));m=ct.promises,c.chmod=m.chmod,c.copyFile=m.copyFile,c.lstat=m.lstat,c.mkdir=m.mkdir,c.readdir=m.readdir,c.readlink=m.readlink,c.rename=m.rename,c.rmdir=m.rmdir,c.stat=m.stat,c.symlink=m.symlink,c.unlink=m.unlink;c.IS_WINDOWS=process.platform==="win32";function ut(e){return j(this,void 0,void 0,function*(){try{yield c.stat(e)}catch(t){if(t.code==="ENOENT")return!1;throw t}return!0})}c.exists=ut;function at(e,t=!1){return j(this,void 0,void 0,function*(){return(t?yield c.stat(e):yield c.lstat(e)).isDirectory()})}c.isDirectory=at;function lt(e){if(e=dt(e),!e)throw new Error('isRooted() parameter "p" cannot be empty');return c.IS_WINDOWS?e.startsWith("\\")||/^[A-Z]:/i.test(e):e.startsWith("/")}c.isRooted=lt;function ae(e,t=1e3,r=1){return j(this,void 0,void 0,function*(){if(st.ok(e,"a path argument must be provided"),e=O.resolve(e),r>=t)return c.mkdir(e);try{yield c.mkdir(e);return}catch(i){switch(i.code){case"ENOENT":{yield ae(O.dirname(e),t,r+1),yield c.mkdir(e);return}default:{let s;try{s=yield c.stat(e)}catch(o){throw i}if(!s.isDirectory())throw i}}}})}c.mkdirP=ae;function ft(e,t){return j(this,void 0,void 0,function*(){let r;try{r=yield c.stat(e)}catch(s){s.code!=="ENOENT"&&console.log(`Unexpected error attempting to determine if executable file exists '${e}': ${s}`)}if(r&&r.isFile()){if(c.IS_WINDOWS){let s=O.extname(e).toUpperCase();if(t.some(o=>o.toUpperCase()===s))return e}else if(le(r))return e}let i=e;for(let s of t){e=i+s,r=void 0;try{r=yield c.stat(e)}catch(o){o.code!=="ENOENT"&&console.log(`Unexpected error attempting to determine if executable file exists '${e}': ${o}`)}if(r&&r.isFile()){if(c.IS_WINDOWS){try{let o=O.dirname(e),a=O.basename(e).toUpperCase();for(let d of yield c.readdir(o))if(a===d.toUpperCase()){e=O.join(o,d);break}}catch(o){console.log(`Unexpected error attempting to determine the actual case of the file '${e}': ${o}`)}return e}else if(le(r))return e}}return""})}c.tryGetExecutablePath=ft;function dt(e){return e=e||"",c.IS_WINDOWS?(e=e.replace(/\//g,"\\"),e.replace(/\\\\+/g,"\\")):e.replace(/\/\/+/g,"/")}function le(e){return(e.mode&1)>0||(e.mode&8)>0&&e.gid===process.getgid()||(e.mode&64)>0&&e.uid===process.getuid()}});var ve=S(v=>{"use strict";var b=v&&v.__awaiter||function(e,t,r,i){function s(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function d(l){try{p(i.next(l))}catch(h){a(h)}}function E(l){try{p(i.throw(l))}catch(h){a(h)}}function p(l){l.done?o(l.value):s(l.value).then(d,E)}p((i=i.apply(e,t||[])).next())})},F=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(v,"__esModule",{value:!0});var pt=F(require("child_process")),w=F(require("path")),ht=require("util"),u=F(fe()),T=ht.promisify(pt.exec);function yt(e,t,r={}){return b(this,void 0,void 0,function*(){let{force:i,recursive:s}=vt(r),o=(yield u.exists(t))?yield u.stat(t):null;if(o&&o.isFile()&&!i)return;let a=o&&o.isDirectory()?w.join(t,w.basename(e)):t;if(!(yield u.exists(e)))throw new Error(`no such file or directory: ${e}`);if((yield u.stat(e)).isDirectory())if(s)yield ye(e,a,0,i);else throw new Error(`Failed to copy. ${e} is a directory, but tried to copy without recursive flag.`);else{if(w.relative(e,a)==="")throw new Error(`'${a}' and '${e}' are the same file`);yield me(e,a,i)}})}v.cp=yt;function mt(e,t,r={}){return b(this,void 0,void 0,function*(){if(yield u.exists(t)){let i=!0;if((yield u.isDirectory(t))&&(t=w.join(t,w.basename(e)),i=yield u.exists(t)),i)if(r.force==null||r.force)yield de(t);else throw new Error("Destination already exists")}yield x(w.dirname(t)),yield u.rename(e,t)})}v.mv=mt;function de(e){return b(this,void 0,void 0,function*(){if(u.IS_WINDOWS){try{(yield u.isDirectory(e,!0))?yield T(`rd /s /q "${e}"`):yield T(`del /f /a "${e}"`)}catch(t){if(t.code!=="ENOENT")throw t}try{yield u.unlink(e)}catch(t){if(t.code!=="ENOENT")throw t}}else{let t=!1;try{t=yield u.isDirectory(e)}catch(r){if(r.code!=="ENOENT")throw r;return}t?yield T(`rm -rf "${e}"`):yield u.unlink(e)}})}v.rmRF=de;function x(e){return b(this,void 0,void 0,function*(){yield u.mkdirP(e)})}v.mkdirP=x;function pe(e,t){return b(this,void 0,void 0,function*(){if(!e)throw new Error("parameter 'tool' is required");if(t){let i=yield pe(e,!1);if(!i)throw u.IS_WINDOWS?new Error(`Unable to locate executable file: ${e}. Please verify either the file path exists or the file can be found within a directory specified by the PATH environment variable. Also verify the file has a valid extension for an executable file.`):new Error(`Unable to locate executable file: ${e}. Please verify either the file path exists or the file can be found within a directory specified by the PATH environment variable. Also check the file mode to verify the file is executable.`);return i}let r=yield he(e);return r&&r.length>0?r[0]:""})}v.which=pe;function he(e){return b(this,void 0,void 0,function*(){if(!e)throw new Error("parameter 'tool' is required");let t=[];if(u.IS_WINDOWS&&process.env.PATHEXT)for(let s of process.env.PATHEXT.split(w.delimiter))s&&t.push(s);if(u.isRooted(e)){let s=yield u.tryGetExecutablePath(e,t);return s?[s]:[]}if(e.includes(w.sep))return[];let r=[];if(process.env.PATH)for(let s of process.env.PATH.split(w.delimiter))s&&r.push(s);let i=[];for(let s of r){let o=yield u.tryGetExecutablePath(w.join(s,e),t);o&&i.push(o)}return i})}v.findInPath=he;function vt(e){let t=e.force==null?!0:e.force,r=Boolean(e.recursive);return{force:t,recursive:r}}function ye(e,t,r,i){return b(this,void 0,void 0,function*(){if(r>=255)return;r++,yield x(t);let s=yield u.readdir(e);for(let o of s){let a=`${e}/${o}`,d=`${t}/${o}`;(yield u.lstat(a)).isDirectory()?yield ye(a,d,r,i):yield me(a,d,i)}yield u.chmod(t,(yield u.stat(e)).mode)})}function me(e,t,r){return b(this,void 0,void 0,function*(){if((yield u.lstat(e)).isSymbolicLink()){try{yield u.lstat(t),yield u.unlink(t)}catch(s){s.code==="EPERM"&&(yield u.chmod(t,"0666"),yield u.unlink(t))}let i=yield u.readlink(e);yield u.symlink(i,t,u.IS_WINDOWS?"junction":null)}else(!(yield u.exists(t))||r)&&(yield u.copyFile(e,t))})}});var f=D(ce()),_e=D(ve()),ge=D(require("child_process"));function A(e){return e.message!==void 0}async function we(){try{let e=await _t();e!==null&&A(e)&&f.setFailed(e.message)}catch(e){if(A(e)){f.setFailed(e.message);return}f.setFailed("Internal error")}}async function _t(){let e="files",t="",r=f.getInput("config");r.length>0&&(t="--config "+r);let i=f.getInput("project");if(i==="")return{message:"a project name was not provided"};let s=f.getInput("domain");if(s==="")return{message:"a domain name was not provided"};let o="",a=f.getInput("proto");a.length>0&&(o=a);let d="";f.getInput("archive")==="true"&&(d="--archive");let p="",l=f.getInput("version");if(l==="")return{message:"a version for register was not provided"};p="--version "+l,f.getInput("flytesnacks")==="true"&&(e="examples",o="",d="",l==="latest"&&(p=""));let U="",q=f.getInput("k8ServiceAccount");q.length>0&&(U="--k8ServiceAccount "+q);let M="",W=f.getInput("outputLocationPrefix");W.length>0&&(M="--outputLocationPrefix "+W);let R="",G=f.getInput("sourceUploadPath");G.length>0&&(R="--sourceUploadPath "+G);let V="";f.getInput("dryRun").length>0&&(V="--dryRun");let B="--continueOnError";f.getInput("continueOnError")===""&&(B="");let H=await _e.which("flytectl",!0);if(H==="")return{message:'flytectl is not installed; please add the "unionai/flytectl-setup-action" step to your job found at https://github.com/unionai/flytectl-setup-action'};let L=`${H} register ${e} ${o}  -p ${i} -d ${s} ${V} ${R} ${B} ${d} ${M} ${U} ${t} ${p}`;f.info(`Running flytectl command ${L}`);try{let N=ge.default.execSync(L,{encoding:"utf-8"});f.info(N)}catch(N){return{message:N}}return null}we();
//# sourceMappingURL=main.js.map
